<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="Create CONSTRAINTS for COUNTRIES" author="Liquibase" runAlways="true" runOnChange="true"
               failOnError="true">
        <sql stripComments="true">
            ALTER TABLE COUNTRIES ADD CONSTRAINT COUNTRIES_PK PRIMARY KEY (COUNTRY_ID);
            ALTER TABLE COUNTRIES ADD CONSTRAINT COUNTRY_NAME_NOT_NULL CHECK (NAME IS NOT NULL);
            ALTER TABLE COUNTRIES ADD CONSTRAINT COUNTRY_NAME_UNIQUE UNIQUE (NAME);
            ALTER TABLE COUNTRIES ADD CONSTRAINT COUNTRY_NAME_CHECK CHECK (LENGTH(NAME) &gt; 2);
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for HOTELS" author="Liquibase" runAlways="true" runOnChange="true" failOnError="true">
        <sql stripComments="true">
            ALTER TABLE HOTELS ADD CONSTRAINT HOTELS_PK PRIMARY KEY (HOTEL_ID);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_NAME_NOT_NULL CHECK (NAME IS NOT NULL);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_NAME_UNIQUE UNIQUE (NAME);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_NAME_CHECK CHECK (LENGTH(NAME) &gt; 3);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_STARS_NOT_NULL CHECK (STARS IS NOT NULL);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_STARS_CHECK CHECK (STARS &gt; 0 AND STARS &lt; 6);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_WEBSITE_NOT_NULL CHECK (WEBSITE IS NOT NULL);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_WEBSITE_UNIQUE UNIQUE (WEBSITE);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_LATITUDE_NOT_NULL CHECK (LATITUDE IS NOT NULL);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_LATITUDE_CHECK CHECK (LATITUDE &gt; -90.0000000 AND LATITUDE &lt;
            90.0000000);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_LONGITUDE_NOT_NULL CHECK (LONGITUDE IS NOT NULL);
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_LONGITUDE_CHECK CHECK (LONGITUDE &gt; -180.000000 AND LONGITUDE &lt;
            180.000000);
        </sql>
        <sql dbms="oracle" stripComments="true">
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_WEBSITE_REGEX_CHECK CHECK (REGEXP_LIKE(WEBSITE,
            '^(https?:\/\/)?(www\.)?([a-z0-9\.\-]+)\.([a-z\.]{2,6})(\/[a-z0-9\.\-]*)*\/?$'));
        </sql>
        <sql dbms="postgresql" stripComments="true">
            ALTER TABLE HOTELS ADD CONSTRAINT HOTEL_WEBSITE_REGEX_CHECK CHECK (WEBSITE::TEXT ~
            '^(https?:\/\/)?(www\.)?([a-z0-9\.-]+)\.([a-z\.]{2,6})(\/[a-z0-9\.-]*)*\/?$'::TEXT);
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for FEATURES" author="Liquibase" runAlways="true" runOnChange="true"
               failOnError="true">
        <sql stripComments="true">
            ALTER TABLE FEATURES ADD CONSTRAINT FEATURES_PK PRIMARY KEY (FEATURE_ID);
            ALTER TABLE FEATURES ADD CONSTRAINT FEATURE_NAME_NOT_NULL CHECK (NAME IS NOT NULL);
            ALTER TABLE FEATURES ADD CONSTRAINT FEATURE_NAME_UNIQUE UNIQUE (NAME);
            ALTER TABLE FEATURES ADD CONSTRAINT FEATURE_NAME_CHECK CHECK (LENGTH(NAME) &gt; 2)
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for HOTELS_FEATURES" author="Liquibase" runAlways="true" runOnChange="true"
               failOnError="true">
        <sql stripComments="true">
            ALTER TABLE HOTELS_FEATURES ADD CONSTRAINT HOTELS_FEATURES_PK PRIMARY KEY (HOTEL_ID, FEATURE_ID);
            ALTER TABLE HOTELS_FEATURES ADD CONSTRAINT HOTELS_FEATURES_HOTEL_ID_FK FOREIGN KEY (HOTEL_ID) REFERENCES HOTELS (HOTEL_ID);
            ALTER TABLE HOTELS_FEATURES ADD CONSTRAINT HOTELS_FEATURES_FEATURE_ID_FK FOREIGN KEY (FEATURE_ID) REFERENCES FEATURES (FEATURE_ID);
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for USERS" author="Liquibase" runAlways="true" runOnChange="true" failOnError="true">
        <sql stripComments="true">
            ALTER TABLE USERS ADD CONSTRAINT USERS_PK PRIMARY KEY (USER_ID);
            ALTER TABLE USERS ADD CONSTRAINT USER_LOGIN_CHECK CHECK (LENGTH(LOGIN) &gt; 4);
            ALTER TABLE USERS ADD CONSTRAINT USER_PASSWORD_CHECK CHECK (LENGTH(PASSWORD) &gt; 4);
            ALTER TABLE USERS ADD CONSTRAINT USER_ROLE_CHECK CHECK (LENGTH(ROLE) &gt; 3 AND ROLE IN ('USER', 'ADMIN'));
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for TOURS" author="Liquibase" runAlways="true" runOnChange="true" failOnError="true">
        <sql stripComments="true">
            ALTER TABLE TOURS ADD CONSTRAINT TOURS_PK PRIMARY KEY (TOUR_ID);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_START_DATE_NOT_NULL CHECK (START_DATE IS NOT NULL);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_END_DATE_NOT_NULL CHECK (END_DATE IS NOT NULL);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_DESCRIPTION_NOT_NULL CHECK (DESCRIPTION IS NOT NULL);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_COST_NOT_NULL CHECK (COST IS NOT NULL);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_COST_CHECK CHECK(COST > 0.0000);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_TYPE_NOT_NULL CHECK (TOUR_TYPE IS NOT NULL);
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_TYPE_CHECK CHECK(TOUR_TYPE IN ('BUSINESS', 'ECOTOURISM', 'LEISURE',
            'PILGRIMAGE', 'RURAL_TOURISM', 'SCIENTIFIC_EXPEDITION', 'SPORT_COMPETITION', 'TOURISM', 'TRAINING',
            'TREATMENT'));
            ALTER TABLE TOURS ADD CONSTRAINT TOURS_COUNTRY_ID_FK FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES (COUNTRY_ID);
            ALTER TABLE TOURS ADD CONSTRAINT TOURS_HOTEL_ID_FK FOREIGN KEY (HOTEL_ID) REFERENCES HOTELS (HOTEL_ID);
        </sql>
        <sql dbms="postgresql" stripComments="true">
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_START_DATE_CHECK CHECK (START_DATE &gt;= NOW());
            ALTER TABLE TOURS ADD CONSTRAINT TOUR_END_DATE_CHECK CHECK (AGE(END_DATE, START_DATE) &gt;= '1
            DAY'::INTERVAL);
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for USERS_TOURS" author="Liquibase" runAlways="true" runOnChange="true" failOnError="true">
        <sql stripComments="true">
            ALTER TABLE USERS_TOURS ADD CONSTRAINT USERS_TOURS_PK PRIMARY KEY (USER_ID, TOUR_ID);
            ALTER TABLE USERS_TOURS ADD CONSTRAINT USERS_TOURS_USER_ID_FK FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID);
            ALTER TABLE USERS_TOURS ADD CONSTRAINT USERS_TOURS_TOUR_ID_FK FOREIGN KEY (TOUR_ID) REFERENCES TOURS (TOUR_ID);
        </sql>
    </changeSet>

    <changeSet id="Create CONSTRAINTS for REVIEWS" author="Liquibase" runAlways="true" runOnChange="true" failOnError="true">
        <sql stripComments="true">
            ALTER TABLE REVIEWS ADD CONSTRAINT REVIEWS_PK PRIMARY KEY (REVIEW_ID);
            ALTER TABLE REVIEWS ADD CONSTRAINT REVIEW_DATE_NOT_NULL CHECK (REVIEW_DATE IS NOT NULL);
            ALTER TABLE REVIEWS ADD CONSTRAINT REVIEW_TEXT_NOT_NULL CHECK (REVIEW_TEXT IS NOT NULL);
            ALTER TABLE REVIEWS ADD CONSTRAINT REVIEWS_USER_ID_FK FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID);
            ALTER TABLE REVIEWS ADD CONSTRAINT REVIEWS_TOUR_ID_FK FOREIGN KEY (TOUR_ID) REFERENCES TOURS (TOUR_ID);
        </sql>
        <sql dbms="postgresql" stripComments="true">
            ALTER TABLE REVIEWS ADD CONSTRAINT REVIEW_DATE_CHECK CHECK (REVIEW_DATE &gt;= NOW());
        </sql>
    </changeSet>

</databaseChangeLog>